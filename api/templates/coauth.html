{% extends "base.html" %}
{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/static/bootstrap-autocomplete/autocomplete.js"></script>
<script>
$(document).on('keypress', 'input', function(e) {
  if (e.which === 13) {
    var focusedElement = $(':focus');
    var eid = focusedElement.attr('id');
    e.preventDefault();
    if (eid == 'coauth1' || eid == 'coauth2') {
        find_coauths();
    }
  }
  return;
});
  function find_coauths_bad() {
    var focusedElement = $(':focus');
    if (!$('#coauth1').val() || !$('#coauth2').val()) {
      alert("You must enter two authors");
      return;
    }
    if ($('#coauth1').val() == $('#coauth2').val()) {
      alert("You must enter different authors");
      return;
    }
    const payload = {"name1": $('#coauth1').val(),
                     "name2": $('#coauth2').val()}
    $.ajax({
      url: '/dois_coauthors',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(payload),
      success: function(response) {
        $('body').html(response);
      },
      error: function(xhr, status, error) {
        console.error("Error:", error);
      }
    });
  }
</script>
  <script>
    function find_coauths() {
      if (!$('#coauth1').val() || !$('#coauth2').val()) {
        alert("You must enter two authors");
        return;
      }
      if ($('#coauth1').val() == $('#coauth2').val()) {
        alert("You must enter different authors");
        return;
      }
      var formData = new FormData();
      formData.append('name1', $('#coauth1').val());
      formData.append('name2', $('#coauth2').val());
      fetch('/dois_coauthors', {
        method: 'POST',
        body: formData,
      })
      .then(response => response.redirected ? window.location = response.url : response.text())
      .then(data => {
        if (typeof data === "string") {
          document.body.innerHTML = data;
        }
      })
      .catch(error => {
        alert('Error: ' + error);
      });
    }
  </script>
{% endblock %}
{% block onload %}
onload="tableInitialize();"
{% endblock %}

{% block content %}
<h2>Search</h2>
<form>
<div class="flexcontainer">
  <div class="flexitem">
  <span class="form-control-lg">Find co-authors:</span>
  </div>
  <div class="flexitem">
    <div class="form-group">
      <input type="text" class="form-control" placeholder="Select an author" list="list-coauth1" id="coauth1">
      <datalist id="list-coauth1">
        {{ people | safe }}
      </datalist>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', e => {
          $('#coauth1').autocomplete()
      }, false);
    </script>
  </div>
  <div class="flexitem">
    <div class="form-group">
      <input type="text" class="form-control" placeholder="Select an author" list="list-coauth2" id="coauth2">
      <datalist id="list-coauth2">
        {{ people | safe }}
      </datalist>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', e => {
          $('#coauth2').autocomplete()
      }, false);
    </script>
  </div>
  <div class="flexitem">
    <button type="submit" id="coauthb" class="btn btn-primary btn-md" onclick="find_coauths(); return false;" href="#">Look up</button>
  </div>
</div>
</form>
{% endblock %}
